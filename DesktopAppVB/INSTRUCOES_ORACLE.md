# ?? Instruções para Configurar Oracle no Projeto VB.NET

## ? O que foi feito

Todos os arquivos foram atualizados para usar **Oracle.ManagedDataAccess.Client** ao invés de ADODB:

### Arquivos Modificados:
1. ? **Module1.vb** - Funções base Oracle (ExecutarConsulta, ExecutarComando, etc.)
2. ? **frm_funcionario.vb** - Carregamento com OracleDataReader
3. ? **cad_funcionario.vb** - CRUD com Oracle e TO_DATE
4. ? **frm_empresa.vb** - Carregamento com OracleDataReader  
5. ? **cad_empresa.vb** - CRUD com Oracle

## ?? Instalar Pacote Oracle.ManagedDataAccess

### Opção 1: Via NuGet Package Manager (Visual Studio)

1. Abra seu projeto no Visual Studio
2. Clique com botão direito no projeto ? **Manage NuGet Packages**
3. Clique na aba **Browse**
4. Pesquise por: `Oracle.ManagedDataAccess`
5. Selecione o pacote **Oracle.ManagedDataAccess**
6. Clique em **Install**
7. Aceite as licenças

### Opção 2: Via Package Manager Console

```powershell
Install-Package Oracle.ManagedDataAccess
```

### Opção 3: Via .NET CLI (PowerShell no diretório do projeto)

```powershell
cd C:\Users\Guto\source\repos\coldguto22\Ponto_Offline_VB\DesktopAppVB
dotnet add package Oracle.ManagedDataAccess
```

## ?? Configurar String de Conexão

### No Module1.vb, atualize as credenciais:

```vb
' Configuração Oracle
Public DefaultDataSource As String = "PONTO_OFFLINE"  ' Nome do TNS ou connection string
Public DefaultUser As String = "seu_usuario"          ' ?? ALTERE AQUI
Public DefaultPassword As String = "sua_senha" ' ?? ALTERE AQUI
Public DefaultPort As Integer = 1521
```

### Tipos de Connection String:

#### Opção 1: Usando TNS (Recomendado)
```vb
Dim connString As String = $"Data Source={DefaultDataSource};User Id={DefaultUser};Password={DefaultPassword};"
```

#### Opção 2: Conexão Direta (sem TNS)
```vb
Dim connString As String = $"Data Source=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=localhost)(PORT={DefaultPort}))(CONNECT_DATA=(SERVICE_NAME=xe)));User Id={DefaultUser};Password={DefaultPassword};"
```

#### Opção 3: Oracle Cloud (Autonomous Database)
```vb
Dim connString As String = $"Data Source=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCPS)(HOST=<your-host>)(PORT=1522))(CONNECT_DATA=(SERVICE_NAME=<service_name>)));User Id={DefaultUser};Password={DefaultPassword};SSL_SERVER_CERT_DN=<cert_dn>;"
```

## ?? Criar Tabelas no Oracle

Execute os scripts SQL no Oracle:

### 1. Tabela de Empresas
```sql
CREATE TABLE tb_empresas (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    cnpj VARCHAR2(18) UNIQUE NOT NULL,
    razao_social VARCHAR2(255) NOT NULL,
    nome_fantasia VARCHAR2(255),
 insc_estadual VARCHAR2(20),
    endereco VARCHAR2(500),
    telefone VARCHAR2(20),
    email VARCHAR2(100),
    logo VARCHAR2(500)
);
```

### 2. Tabela de Funcionários
```sql
CREATE TABLE tb_funcionarios (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    cpf VARCHAR2(14) UNIQUE NOT NULL,
    nome VARCHAR2(255) NOT NULL,
    email VARCHAR2(100),
    cargo VARCHAR2(100),
    ativo NUMBER(1) DEFAULT 1,
    data_cadastro DATE DEFAULT SYSDATE,
    data_admissao DATE,
    data_nasc DATE,
    pis VARCHAR2(15),
    empresa VARCHAR2(255),
    folha VARCHAR2(50),
    horario VARCHAR2(100),
    data_demissao DATE,
    foto VARCHAR2(500)
);
```

### 3. Tabela de Registros de Ponto
```sql
CREATE TABLE tb_registros_ponto (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    funcionario_id NUMBER NOT NULL,
    data DATE NOT NULL,
    hora TIMESTAMP NOT NULL,
    tipo VARCHAR2(16) NOT NULL,
    latitude NUMBER(10,6),
    longitude NUMBER(10,6),
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_funcionario FOREIGN KEY (funcionario_id) REFERENCES tb_funcionarios(id)
);
```

## ?? Testar Conexão

### 1. Execute o projeto
Ao rodar `Sub Main()` em Module1.vb, você verá:
- ? "Conexão OK - Oracle (PONTO_OFFLINE)" se sucesso
- ? Mensagem de erro detalhada se falhar

### 2. Verificações de Erro Comuns

| Erro | Solução |
|------|---------|
| `ORA-12154: TNS:could not resolve...` | Nome do TNS incorreto. Verifique `tnsnames.ora` |
| `ORA-01017: invalid username/password` | Credenciais incorretas |
| `ORA-12541: TNS:no listener` | Oracle Listener não está rodando |
| `Type 'OracleConnection' not defined` | Pacote NuGet não instalado |

## ?? Diferenças Oracle vs SQL Server

### Datas
- **SQL Server:** `'2025-01-01'` (string simples)
- **Oracle:** `TO_DATE('01/01/2025', 'DD/MM/YYYY')`

### Identity/Auto-increment
- **SQL Server:** `IDENTITY(1,1)`
- **Oracle:** `GENERATED BY DEFAULT AS IDENTITY`

### Tipos de Dados
| SQL Server | Oracle |
|------------|--------|
| `NVARCHAR(MAX)` | `VARCHAR2(4000)` ou `CLOB` |
| `BIT` | `NUMBER(1)` |
| `DATETIME` | `DATE` ou `TIMESTAMP` |

### Funções
| SQL Server | Oracle |
|------------|--------|
| `GETDATE()` | `SYSDATE` ou `CURRENT_TIMESTAMP` |
| `LEN()` | `LENGTH()` |
| `CONCAT()` | `||` (operador) |

## ?? Migração de Dados SQL Server ? Oracle

Se você já tem dados no SQL Server:

```sql
-- No SQL Server, exporte para CSV
-- No Oracle, importe usando SQL*Loader ou:

-- Exemplo de INSERT
INSERT INTO tb_empresas (cnpj, razao_social, nome_fantasia)
SELECT cnpj, razao_social, nome_fantasia 
FROM sqlserver_table@dblink;
```

## ? Checklist Final

- [ ] Pacote `Oracle.ManagedDataAccess` instalado
- [ ] Connection string configurada em Module1.vb
- [ ] Credenciais corretas (usuário/senha)
- [ ] Oracle rodando e acessível
- [ ] Tabelas criadas no banco
- [ ] Imports adicionados em todos os arquivos VB
- [ ] Projeto compila sem erros
- [ ] Teste de conexão bem-sucedido

## ?? Suporte

### Documentação Oracle
- [Oracle Data Provider for .NET](https://www.oracle.com/database/technologies/appdev/dotnet/odp.html)
- [Connection Strings](https://www.connectionstrings.com/oracle/)

### Ferramentas Úteis
- **SQL Developer** - IDE para Oracle
- **TNS Ping** - Testar conectividade: `tnsping PONTO_OFFLINE`
- **Oracle Instant Client** - Se necessário

---

**Desenvolvido para:** Ponto_Offline_VB  
**Data:** 2025  
**Versão Oracle:** Compatível com 11g+, 12c, 19c, 21c  
**Status:** ? Pronto para uso
